{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.array.push.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nfunction throttledQueue(maxRequestsPerInterval, interval, evenlySpaced) {\n  if (evenlySpaced === void 0) {\n    evenlySpaced = false;\n  }\n  /**\n   * If all requests should be evenly spaced, adjust to suit.\n   */\n  if (evenlySpaced) {\n    interval = interval / maxRequestsPerInterval;\n    maxRequestsPerInterval = 1;\n  }\n  var queue = [];\n  var lastIntervalStart = 0;\n  var numRequestsPerInterval = 0;\n  var timeout;\n  /**\n   * Gets called at a set interval to remove items from the queue.\n   * This is a self-adjusting timer, since the browser's setTimeout is highly inaccurate.\n   */\n  var dequeue = function () {\n    var intervalEnd = lastIntervalStart + interval;\n    var now = Date.now();\n    /**\n     * Adjust the timer if it was called too early.\n     */\n    if (now < intervalEnd) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n      timeout !== undefined && clearTimeout(timeout);\n      timeout = setTimeout(dequeue, intervalEnd - now);\n      return;\n    }\n    lastIntervalStart = now;\n    numRequestsPerInterval = 0;\n    for (var _i = 0, _a = queue.splice(0, maxRequestsPerInterval); _i < _a.length; _i++) {\n      var callback = _a[_i];\n      numRequestsPerInterval++;\n      void callback();\n    }\n    if (queue.length) {\n      timeout = setTimeout(dequeue, interval);\n    } else {\n      timeout = undefined;\n    }\n  };\n  return function (fn) {\n    return new Promise(function (resolve, reject) {\n      var callback = function () {\n        return Promise.resolve().then(fn).then(resolve).catch(reject);\n      };\n      var now = Date.now();\n      if (timeout === undefined && now - lastIntervalStart > interval) {\n        lastIntervalStart = now;\n        numRequestsPerInterval = 0;\n      }\n      if (numRequestsPerInterval++ < maxRequestsPerInterval) {\n        void callback();\n      } else {\n        queue.push(callback);\n        if (timeout === undefined) {\n          timeout = setTimeout(dequeue, lastIntervalStart + interval - now);\n        }\n      }\n    });\n  };\n}\nmodule.exports = throttledQueue;\nexports.default = throttledQueue;","map":{"version":3,"mappings":";;;;;;AAAA,SAASA,cAAc,CACrBC,sBAA8B,EAC9BC,QAAgB,EAChBC,YAAoB;EAApB;IAAAA,oBAAoB;EAAA;EAEpB;;;EAGA,IAAIA,YAAY,EAAE;IAChBD,QAAQ,GAAGA,QAAQ,GAAGD,sBAAsB;IAC5CA,sBAAsB,GAAG,CAAC;;EAE5B,IAAMG,KAAK,GAA+B,EAAE;EAC5C,IAAIC,iBAAiB,GAAG,CAAC;EACzB,IAAIC,sBAAsB,GAAG,CAAC;EAC9B,IAAIC,OAAmC;EACvC;;;;EAIA,IAAMC,OAAO,GAAG;IACd,IAAMC,WAAW,GAAGJ,iBAAiB,GAAGH,QAAQ;IAChD,IAAMQ,GAAG,GAAGC,IAAI,CAACD,GAAG,EAAE;IACtB;;;IAGA,IAAIA,GAAG,GAAGD,WAAW,EAAE;MACrB;MACAF,OAAO,KAAKK,SAAS,IAAIC,YAAY,CAACN,OAAO,CAAC;MAC9CA,OAAO,GAAGO,UAAU,CAACN,OAAO,EAAEC,WAAW,GAAGC,GAAG,CAAC;MAChD;;IAEFL,iBAAiB,GAAGK,GAAG;IACvBJ,sBAAsB,GAAG,CAAC;IAC1B,KAAuB,UAAuC,EAAvCS,UAAK,CAACC,MAAM,CAAC,CAAC,EAAEf,sBAAsB,CAAC,EAAvCgB,cAAuC,EAAvCA,IAAuC,EAAE;MAA3D,IAAMC,QAAQ;MACjBZ,sBAAsB,EAAE;MACxB,KAAKY,QAAQ,EAAE;;IAEjB,IAAId,KAAK,CAACe,MAAM,EAAE;MAChBZ,OAAO,GAAGO,UAAU,CAACN,OAAO,EAAEN,QAAQ,CAAC;KACxC,MAAM;MACLK,OAAO,GAAGK,SAAS;;EAEvB,CAAC;EAED,OAAO,UAAmBQ,EAAkC;IAAsB,WAAIC,OAAO,CAC3F,UAACC,OAAO,EAAEC,MAAM;MACd,IAAML,QAAQ,GAAG;QAAM,cAAO,CAACI,OAAO,EAAE,CAACE,IAAI,CAACJ,EAAE,CAAC,CAACI,IAAI,CAACF,OAAO,CAAC,CAACG,KAAK,CAACF,MAAM,CAAC;MAAtD,CAAsD;MAC7E,IAAMb,GAAG,GAAGC,IAAI,CAACD,GAAG,EAAE;MACtB,IAAIH,OAAO,KAAKK,SAAS,IAAKF,GAAG,GAAGL,iBAAiB,GAAIH,QAAQ,EAAE;QACjEG,iBAAiB,GAAGK,GAAG;QACvBJ,sBAAsB,GAAG,CAAC;;MAE5B,IAAIA,sBAAsB,EAAE,GAAGL,sBAAsB,EAAE;QACrD,KAAKiB,QAAQ,EAAE;OAChB,MAAM;QACLd,KAAK,CAACsB,IAAI,CAACR,QAAQ,CAAC;QACpB,IAAIX,OAAO,KAAKK,SAAS,EAAE;UACzBL,OAAO,GAAGO,UAAU,CAACN,OAAO,EAAEH,iBAAiB,GAAGH,QAAQ,GAAGQ,GAAG,CAAC;;;IAGvE,CAAC,CACF;EAjBiF,CAiBjF;AACH;AACAiB,MAAM,CAACC,OAAO,GAAG5B,cAAc;AAC/B4B,kBAAe5B,cAAc","names":["throttledQueue","maxRequestsPerInterval","interval","evenlySpaced","queue","lastIntervalStart","numRequestsPerInterval","timeout","dequeue","intervalEnd","now","Date","undefined","clearTimeout","setTimeout","_a","splice","_i","callback","length","fn","Promise","resolve","reject","then","catch","push","module","exports"],"sourceRoot":"","sources":["../src/throttledQueue.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}