{"ast":null,"code":"import { isCloudflareWorkers } from '../runtime/env.js';\nfunction unusable(name, prop = 'algorithm.name') {\n  return new TypeError(`CryptoKey does not support this operation, its ${prop} must be ${name}`);\n}\nfunction isAlgorithm(algorithm, name) {\n  return algorithm.name === name;\n}\nfunction getHashLength(hash) {\n  return parseInt(hash.name.slice(4), 10);\n}\nfunction getNamedCurve(alg) {\n  switch (alg) {\n    case 'ES256':\n      return 'P-256';\n    case 'ES384':\n      return 'P-384';\n    case 'ES512':\n      return 'P-521';\n    default:\n      throw new Error('unreachable');\n  }\n}\nfunction checkUsage(key, usages) {\n  if (usages.length && !usages.some(expected => key.usages.includes(expected))) {\n    let msg = 'CryptoKey does not support this operation, its usages must include ';\n    if (usages.length > 2) {\n      const last = usages.pop();\n      msg += `one of ${usages.join(', ')}, or ${last}.`;\n    } else if (usages.length === 2) {\n      msg += `one of ${usages[0]} or ${usages[1]}.`;\n    } else {\n      msg += `${usages[0]}.`;\n    }\n    throw new TypeError(msg);\n  }\n}\nexport function checkSigCryptoKey(key, alg, ...usages) {\n  switch (alg) {\n    case 'HS256':\n    case 'HS384':\n    case 'HS512':\n      {\n        if (!isAlgorithm(key.algorithm, 'HMAC')) throw unusable('HMAC');\n        const expected = parseInt(alg.slice(2), 10);\n        const actual = getHashLength(key.algorithm.hash);\n        if (actual !== expected) throw unusable(`SHA-${expected}`, 'algorithm.hash');\n        break;\n      }\n    case 'RS256':\n    case 'RS384':\n    case 'RS512':\n      {\n        if (!isAlgorithm(key.algorithm, 'RSASSA-PKCS1-v1_5')) throw unusable('RSASSA-PKCS1-v1_5');\n        const expected = parseInt(alg.slice(2), 10);\n        const actual = getHashLength(key.algorithm.hash);\n        if (actual !== expected) throw unusable(`SHA-${expected}`, 'algorithm.hash');\n        break;\n      }\n    case 'PS256':\n    case 'PS384':\n    case 'PS512':\n      {\n        if (!isAlgorithm(key.algorithm, 'RSA-PSS')) throw unusable('RSA-PSS');\n        const expected = parseInt(alg.slice(2), 10);\n        const actual = getHashLength(key.algorithm.hash);\n        if (actual !== expected) throw unusable(`SHA-${expected}`, 'algorithm.hash');\n        break;\n      }\n    case isCloudflareWorkers() && 'EdDSA':\n      {\n        if (!isAlgorithm(key.algorithm, 'NODE-ED25519')) throw unusable('NODE-ED25519');\n        break;\n      }\n    case 'EdDSA':\n      {\n        if (key.algorithm.name !== 'Ed25519' && key.algorithm.name !== 'Ed448') {\n          throw unusable('Ed25519 or Ed448');\n        }\n        break;\n      }\n    case 'ES256':\n    case 'ES384':\n    case 'ES512':\n      {\n        if (!isAlgorithm(key.algorithm, 'ECDSA')) throw unusable('ECDSA');\n        const expected = getNamedCurve(alg);\n        const actual = key.algorithm.namedCurve;\n        if (actual !== expected) throw unusable(expected, 'algorithm.namedCurve');\n        break;\n      }\n    default:\n      throw new TypeError('CryptoKey does not support this operation');\n  }\n  checkUsage(key, usages);\n}\nexport function checkEncCryptoKey(key, alg, ...usages) {\n  switch (alg) {\n    case 'A128GCM':\n    case 'A192GCM':\n    case 'A256GCM':\n      {\n        if (!isAlgorithm(key.algorithm, 'AES-GCM')) throw unusable('AES-GCM');\n        const expected = parseInt(alg.slice(1, 4), 10);\n        const actual = key.algorithm.length;\n        if (actual !== expected) throw unusable(expected, 'algorithm.length');\n        break;\n      }\n    case 'A128KW':\n    case 'A192KW':\n    case 'A256KW':\n      {\n        if (!isAlgorithm(key.algorithm, 'AES-KW')) throw unusable('AES-KW');\n        const expected = parseInt(alg.slice(1, 4), 10);\n        const actual = key.algorithm.length;\n        if (actual !== expected) throw unusable(expected, 'algorithm.length');\n        break;\n      }\n    case 'ECDH':\n      {\n        switch (key.algorithm.name) {\n          case 'ECDH':\n          case 'X25519':\n          case 'X448':\n            break;\n          default:\n            throw unusable('ECDH, X25519, or X448');\n        }\n        break;\n      }\n    case 'PBES2-HS256+A128KW':\n    case 'PBES2-HS384+A192KW':\n    case 'PBES2-HS512+A256KW':\n      if (!isAlgorithm(key.algorithm, 'PBKDF2')) throw unusable('PBKDF2');\n      break;\n    case 'RSA-OAEP':\n    case 'RSA-OAEP-256':\n    case 'RSA-OAEP-384':\n    case 'RSA-OAEP-512':\n      {\n        if (!isAlgorithm(key.algorithm, 'RSA-OAEP')) throw unusable('RSA-OAEP');\n        const expected = parseInt(alg.slice(9), 10) || 1;\n        const actual = getHashLength(key.algorithm.hash);\n        if (actual !== expected) throw unusable(`SHA-${expected}`, 'algorithm.hash');\n        break;\n      }\n    default:\n      throw new TypeError('CryptoKey does not support this operation');\n  }\n  checkUsage(key, usages);\n}","map":{"version":3,"names":["isCloudflareWorkers","unusable","name","prop","TypeError","isAlgorithm","algorithm","getHashLength","hash","parseInt","slice","getNamedCurve","alg","Error","checkUsage","key","usages","length","some","expected","includes","msg","last","pop","join","checkSigCryptoKey","actual","namedCurve","checkEncCryptoKey"],"sources":["/Users/shepher/Downloads/filename-space/node_modules/jose/dist/browser/lib/crypto_key.js"],"sourcesContent":["import { isCloudflareWorkers } from '../runtime/env.js';\nfunction unusable(name, prop = 'algorithm.name') {\n    return new TypeError(`CryptoKey does not support this operation, its ${prop} must be ${name}`);\n}\nfunction isAlgorithm(algorithm, name) {\n    return algorithm.name === name;\n}\nfunction getHashLength(hash) {\n    return parseInt(hash.name.slice(4), 10);\n}\nfunction getNamedCurve(alg) {\n    switch (alg) {\n        case 'ES256':\n            return 'P-256';\n        case 'ES384':\n            return 'P-384';\n        case 'ES512':\n            return 'P-521';\n        default:\n            throw new Error('unreachable');\n    }\n}\nfunction checkUsage(key, usages) {\n    if (usages.length && !usages.some((expected) => key.usages.includes(expected))) {\n        let msg = 'CryptoKey does not support this operation, its usages must include ';\n        if (usages.length > 2) {\n            const last = usages.pop();\n            msg += `one of ${usages.join(', ')}, or ${last}.`;\n        }\n        else if (usages.length === 2) {\n            msg += `one of ${usages[0]} or ${usages[1]}.`;\n        }\n        else {\n            msg += `${usages[0]}.`;\n        }\n        throw new TypeError(msg);\n    }\n}\nexport function checkSigCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512': {\n            if (!isAlgorithm(key.algorithm, 'HMAC'))\n                throw unusable('HMAC');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'RS256':\n        case 'RS384':\n        case 'RS512': {\n            if (!isAlgorithm(key.algorithm, 'RSASSA-PKCS1-v1_5'))\n                throw unusable('RSASSA-PKCS1-v1_5');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'PS256':\n        case 'PS384':\n        case 'PS512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-PSS'))\n                throw unusable('RSA-PSS');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case isCloudflareWorkers() && 'EdDSA': {\n            if (!isAlgorithm(key.algorithm, 'NODE-ED25519'))\n                throw unusable('NODE-ED25519');\n            break;\n        }\n        case 'EdDSA': {\n            if (key.algorithm.name !== 'Ed25519' && key.algorithm.name !== 'Ed448') {\n                throw unusable('Ed25519 or Ed448');\n            }\n            break;\n        }\n        case 'ES256':\n        case 'ES384':\n        case 'ES512': {\n            if (!isAlgorithm(key.algorithm, 'ECDSA'))\n                throw unusable('ECDSA');\n            const expected = getNamedCurve(alg);\n            const actual = key.algorithm.namedCurve;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.namedCurve');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\nexport function checkEncCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM': {\n            if (!isAlgorithm(key.algorithm, 'AES-GCM'))\n                throw unusable('AES-GCM');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (!isAlgorithm(key.algorithm, 'AES-KW'))\n                throw unusable('AES-KW');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'ECDH': {\n            switch (key.algorithm.name) {\n                case 'ECDH':\n                case 'X25519':\n                case 'X448':\n                    break;\n                default:\n                    throw unusable('ECDH, X25519, or X448');\n            }\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW':\n            if (!isAlgorithm(key.algorithm, 'PBKDF2'))\n                throw unusable('PBKDF2');\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-OAEP'))\n                throw unusable('RSA-OAEP');\n            const expected = parseInt(alg.slice(9), 10) || 1;\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}