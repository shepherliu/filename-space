{"version":3,"file":"index.modern.js","sources":["../src/index.ts","../src/version.ts"],"sourcesContent":["import type UAuthSPA from '@uauth/js'\nimport type {UAuthConstructorOptions, UserInfo} from '@uauth/js'\nimport Web3Modal, {\n  connectors,\n  IAbstractConnectorOptions,\n  IProviderDisplay,\n} from 'web3modal'\nimport {VERSION} from './version'\n\nif (typeof window !== 'undefined') {\n  const _w = window as any\n  _w.UAUTH_VERSION = _w.UAUTH_VERSION || {}\n  _w.UAUTH_VERSION.WEB3MODAL = VERSION\n}\n\nexport interface IUAuthOptions\n  extends Partial<IAbstractConnectorOptions>,\n    UAuthConstructorOptions {\n  shouldLoginWithRedirect?: boolean\n}\n\nlet w3m: Web3Modal\nexport const registerWeb3Modal: (web3modal: Web3Modal) => void = web3modal => {\n  w3m = web3modal\n}\n\nexport const display: IProviderDisplay = {\n  name: 'Unstoppable',\n  logo: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTIyLjczMTkgMi4wNjkzNFY5Ljg3MjI5TDAgMTkuMDk0TDIyLjczMTkgMi4wNjkzNFoiIGZpbGw9IiMyRkU5RkYiLz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE4LjQ2OTYgMS43MTM4N1YxNS4xOTE3QzE4LjQ2OTYgMTkuMTA5NCAxNS4yODkyIDIyLjI4NTMgMTEuMzY1OSAyMi4yODUzQzcuNDQyNjUgMjIuMjg1MyA0LjI2MjIxIDE5LjEwOTQgNC4yNjIyMSAxNS4xOTE3VjkuNTE2ODJMOC41MjQ0MyA3LjE3NTk0VjE1LjE5MTdDOC41MjQ0MyAxNi41NjI5IDkuNjM3NTkgMTcuNjc0NSAxMS4wMTA3IDE3LjY3NDVDMTIuMzgzOSAxNy42NzQ1IDEzLjQ5NyAxNi41NjI5IDEzLjQ5NyAxNS4xOTE3VjQuNDQ0OUwxOC40Njk2IDEuNzEzODdaIiBmaWxsPSIjNEM0N0Y3Ii8+PC9zdmc+',\n  description: 'Enter your Unstoppable domain name',\n}\n\nexport const getUAuth = (\n  UAuth: typeof UAuthSPA,\n  opts: IUAuthOptions,\n): UAuthSPA => {\n  return new UAuth(opts)\n}\n\nexport const connector = async (\n  UAuth: typeof UAuthSPA,\n  opts: IUAuthOptions,\n): Promise<any> => {\n  const uauth = new UAuth(opts)\n\n  let user: UserInfo\n  try {\n    user = await uauth.user()\n  } catch (error) {\n    if (!uauth.fallbackLoginOptions.scope.includes('wallet')) {\n      throw new Error('Must request the \"wallet\" scope for connector to work.')\n    }\n\n    if (opts.shouldLoginWithRedirect) {\n      await uauth.login({\n        packageName: '@uauth/web3modal',\n        packageVersion: VERSION,\n      })\n\n      // NOTE: We don't want to throw because the page will take some time to\n      // load the redirect page.\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      await new Promise<void>(() => {})\n      // We need to throw here otherwise typescript won't know that user isn't null.\n      throw new Error('Should never get here.')\n    } else {\n      await uauth.loginWithPopup({\n        packageName: '@uauth/web3modal',\n        packageVersion: VERSION,\n      })\n      user = await uauth.user()\n    }\n  }\n\n  if (user.wallet_type_hint == null) {\n    throw new Error('no wallet type present')\n  }\n\n  let provider: any\n  if (['web3', 'injected'].includes(user.wallet_type_hint)) {\n    provider = connectors.injected()\n  } else if (user.wallet_type_hint === 'walletconnect') {\n    const id = 'walletconnect'\n\n    provider = connectors.walletconnect(\n      (w3m as any).providerController.getProviderOption(id, 'package'),\n      {\n        network: opts.network,\n        ...(w3m as any).providerController.getProviderOption(id, 'options'),\n      },\n    )\n  } else {\n    throw new Error('Connector not supported')\n  }\n\n  return provider\n}\n","export const VERSION = \"2.4.0\";\n"],"names":["window","_w","UAUTH_VERSION","WEB3MODAL","w3m","registerWeb3Modal","web3modal","display","name","logo","description","getUAuth","UAuth","opts","connector","async","uauth","user","provider","error","fallbackLoginOptions","scope","includes","Error","shouldLoginWithRedirect","login","packageName","packageVersion","Promise","loginWithPopup","wallet_type_hint","connectors","injected","id","walletconnect","providerController","getProviderOption","_extends","network"],"mappings":"uPASA,GAAsB,oBAAXA,OAAwB,CACjC,MAAMC,EAAKD,OACXC,EAAGC,cAAgBD,EAAGC,eAAiB,GACvCD,EAAGC,cAAcC,UCZI,QDqBvB,IAAIC,EACSC,MAAAA,EAAoDC,IAC/DF,EAAME,GAGKC,EAA4B,CACvCC,KAAM,cACNC,KAAM,iwBACNC,YAAa,sCAGFC,EAAW,CACtBC,EACAC,QAEWD,EAAMC,GAGNC,EAAYC,MACvBH,EACAC,KAEA,MAAMG,EAAQ,IAAIJ,EAAMC,GAExB,IAAII,EAiCAC,EAhCJ,IACED,QAAaD,EAAMC,OACnB,MAAOE,GACP,IAAKH,EAAMI,qBAAqBC,MAAMC,SAAS,UAC7C,UAAUC,MAAM,0DAGlB,GAAIV,EAAKW,wBAWP,YAVMR,EAAMS,MAAM,CAChBC,YAAa,mBACbC,eCxDe,gBD8DX,IAAIC,QAAc,QAElB,IAAIL,MAAM,gCAEVP,EAAMa,eAAe,CACzBH,YAAa,mBACbC,eCpEe,UDsEjBV,QAAaD,EAAMC,OAIvB,GAA6B,MAAzBA,EAAKa,iBACP,MAAM,IAAIP,MAAM,0BAIlB,GAAI,CAAC,OAAQ,YAAYD,SAASL,EAAKa,kBACrCZ,EAAWa,EAAWC,eACbf,CAAAA,GAA0B,kBAA1BA,EAAKa,iBAWd,MAAM,IAAIP,MAAM,2BAXoC,CACpD,MAAMU,EAAK,gBAEXf,EAAWa,EAAWG,cACnB9B,EAAY+B,mBAAmBC,kBAAkBH,EAAI,WAD7CI,EAAA,CAGPC,QAASzB,EAAKyB,SACVlC,EAAY+B,mBAAmBC,kBAAkBH,EAAI,cAO/D,OAAOf"}