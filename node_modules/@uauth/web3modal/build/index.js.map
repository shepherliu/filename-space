{"version":3,"file":"index.js","sources":["../src/index.ts","../src/version.ts"],"sourcesContent":["import type UAuthSPA from '@uauth/js'\nimport type {UAuthConstructorOptions, UserInfo} from '@uauth/js'\nimport Web3Modal, {\n  connectors,\n  IAbstractConnectorOptions,\n  IProviderDisplay,\n} from 'web3modal'\nimport {VERSION} from './version'\n\nif (typeof window !== 'undefined') {\n  const _w = window as any\n  _w.UAUTH_VERSION = _w.UAUTH_VERSION || {}\n  _w.UAUTH_VERSION.WEB3MODAL = VERSION\n}\n\nexport interface IUAuthOptions\n  extends Partial<IAbstractConnectorOptions>,\n    UAuthConstructorOptions {\n  shouldLoginWithRedirect?: boolean\n}\n\nlet w3m: Web3Modal\nexport const registerWeb3Modal: (web3modal: Web3Modal) => void = web3modal => {\n  w3m = web3modal\n}\n\nexport const display: IProviderDisplay = {\n  name: 'Unstoppable',\n  logo: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTIyLjczMTkgMi4wNjkzNFY5Ljg3MjI5TDAgMTkuMDk0TDIyLjczMTkgMi4wNjkzNFoiIGZpbGw9IiMyRkU5RkYiLz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE4LjQ2OTYgMS43MTM4N1YxNS4xOTE3QzE4LjQ2OTYgMTkuMTA5NCAxNS4yODkyIDIyLjI4NTMgMTEuMzY1OSAyMi4yODUzQzcuNDQyNjUgMjIuMjg1MyA0LjI2MjIxIDE5LjEwOTQgNC4yNjIyMSAxNS4xOTE3VjkuNTE2ODJMOC41MjQ0MyA3LjE3NTk0VjE1LjE5MTdDOC41MjQ0MyAxNi41NjI5IDkuNjM3NTkgMTcuNjc0NSAxMS4wMTA3IDE3LjY3NDVDMTIuMzgzOSAxNy42NzQ1IDEzLjQ5NyAxNi41NjI5IDEzLjQ5NyAxNS4xOTE3VjQuNDQ0OUwxOC40Njk2IDEuNzEzODdaIiBmaWxsPSIjNEM0N0Y3Ii8+PC9zdmc+',\n  description: 'Enter your Unstoppable domain name',\n}\n\nexport const getUAuth = (\n  UAuth: typeof UAuthSPA,\n  opts: IUAuthOptions,\n): UAuthSPA => {\n  return new UAuth(opts)\n}\n\nexport const connector = async (\n  UAuth: typeof UAuthSPA,\n  opts: IUAuthOptions,\n): Promise<any> => {\n  const uauth = new UAuth(opts)\n\n  let user: UserInfo\n  try {\n    user = await uauth.user()\n  } catch (error) {\n    if (!uauth.fallbackLoginOptions.scope.includes('wallet')) {\n      throw new Error('Must request the \"wallet\" scope for connector to work.')\n    }\n\n    if (opts.shouldLoginWithRedirect) {\n      await uauth.login({\n        packageName: '@uauth/web3modal',\n        packageVersion: VERSION,\n      })\n\n      // NOTE: We don't want to throw because the page will take some time to\n      // load the redirect page.\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      await new Promise<void>(() => {})\n      // We need to throw here otherwise typescript won't know that user isn't null.\n      throw new Error('Should never get here.')\n    } else {\n      await uauth.loginWithPopup({\n        packageName: '@uauth/web3modal',\n        packageVersion: VERSION,\n      })\n      user = await uauth.user()\n    }\n  }\n\n  if (user.wallet_type_hint == null) {\n    throw new Error('no wallet type present')\n  }\n\n  let provider: any\n  if (['web3', 'injected'].includes(user.wallet_type_hint)) {\n    provider = connectors.injected()\n  } else if (user.wallet_type_hint === 'walletconnect') {\n    const id = 'walletconnect'\n\n    provider = connectors.walletconnect(\n      (w3m as any).providerController.getProviderOption(id, 'package'),\n      {\n        network: opts.network,\n        ...(w3m as any).providerController.getProviderOption(id, 'options'),\n      },\n    )\n  } else {\n    throw new Error('Connector not supported')\n  }\n\n  return provider\n}\n","export const VERSION = \"2.4.0\";\n"],"names":["w3m","window","_w","UAUTH_VERSION","WEB3MODAL","UAuth","opts","user","_temp3","_result","wallet_type_hint","Error","provider","includes","connectors","injected","id","walletconnect","providerController","getProviderOption","_extends","network","uauth","_temp4","Promise","resolve","_catch","fallbackLoginOptions","scope","shouldLoginWithRedirect","login","packageName","packageVersion","loginWithPopup","then","e","reject","name","logo","description","web3modal"],"mappings":"IAqBIA,yOAZJ,GAAsB,oBAAXC,OAAwB,CACjC,IAAMC,EAAKD,OACXC,EAAGC,cAAgBD,EAAGC,eAAiB,GACvCD,EAAGC,cAAcC,UCZI,mCDwCrBC,EACAC,GACgB,IAAA,IAGZC,EAHYC,EAAA,SAAAC,GAgChB,GAA6B,MAAzBF,EAAKG,iBACP,UAAUC,MAAM,0BAGlB,IAAIC,EACJ,GAAI,CAAC,OAAQ,YAAYC,SAASN,EAAKG,kBACrCE,EAAWE,EAAUA,WAACC,eACjB,CAAA,GAA8B,kBAA1BR,EAAKG,iBAWd,UAAUC,MAAM,2BAVhB,IAAMK,EAAK,gBAEXJ,EAAWE,aAAWG,cACnBjB,EAAYkB,mBAAmBC,kBAAkBH,EAAI,WAD7CI,EAAA,CAGPC,QAASf,EAAKe,SACVrB,EAAYkB,mBAAmBC,kBAAkBH,EAAI,aAO/D,OAAOJ,GApDDU,EAAQ,IAAIjB,EAAMC,GAGpBiB,0BAAAC,QAAAC,QACWH,EAAMf,QAAnBA,KAAAA,SAAAA,GAAAA,8DADEmB,CAAA,aAGF,IAAKJ,EAAMK,qBAAqBC,MAAMf,SAAS,UAC7C,MAAM,IAAIF,MAAM,0DAFJ,OAKVL,EAAKuB,wBACDP,QAAAA,QAAAA,EAAMQ,MAAM,CAChBC,YAAa,mBACbC,eCxDe,kDD8DX,IAAIR,QAAc,+BAExB,MAAM,IAAIb,MAAM,8BAhBJa,QAAAC,QAkBNH,EAAMW,eAAe,CACzBF,YAAa,mBACbC,eCpEe,WDgDLE,KAAA,WAAA,OAAAV,QAAAC,QAsBCH,EAAMf,QAAnBA,KAAAA,SAAAA,GAAAA,UA0BL,OAAAiB,QAAAC,QAAAF,GAAAA,EAAAW,KAAAX,EAAAW,KAAA1B,GAAAA,KAzDqB,MAAf2B,GAAA,OAAAX,QAAAY,OAAAD,qBAbkC,CACvCE,KAAM,cACNC,KAAM,iwBACNC,YAAa,uDAGS,SACtBlC,EACAC,GAEA,WAAWD,EAAMC,8BAd8C,SAAAkC,GAC/DxC,EAAMwC"}